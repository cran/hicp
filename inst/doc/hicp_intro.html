<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Sebastian Weinand" />


<title>Introduction to the hicp-package</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
margin-bottom: 0em;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to the
<code>hicp</code>-package</h1>
<h4 class="author">Sebastian Weinand</h4>
<h4 class="date">July 2025</h4>


<div id="TOC">
<ul>
<li><a href="#hicp-data" id="toc-hicp-data">HICP data</a>
<ul>
<li><a href="#step-1-available-data-sets" id="toc-step-1-available-data-sets">Step 1: Available data sets</a></li>
<li><a href="#step-2-allowed-data-filters" id="toc-step-2-allowed-data-filters">Step 2: Allowed data
filters</a></li>
<li><a href="#step-3-data-download" id="toc-step-3-data-download">Step
3: Data download</a></li>
</ul></li>
<li><a href="#hicp-and-coicop" id="toc-hicp-and-coicop">HICP and
COICOP</a>
<ul>
<li><a href="#coicop-codes-bundles-and-relatives" id="toc-coicop-codes-bundles-and-relatives">COICOP codes, bundles, and
relatives</a></li>
<li><a href="#deriving-the-coicop-tree-for-index-aggregation" id="toc-deriving-the-coicop-tree-for-index-aggregation">Deriving the
COICOP tree for index aggregation</a></li>
</ul></li>
<li><a href="#index-aggregation-rates-of-change-and-contributions" id="toc-index-aggregation-rates-of-change-and-contributions">Index
aggregation, rates of change, and contributions</a>
<ul>
<li><a href="#index-aggregation" id="toc-index-aggregation">Index
aggregation</a></li>
<li><a href="#rates-of-change-and-contributions" id="toc-rates-of-change-and-contributions">Rates of change and
contributions</a></li>
<li><a href="#quarterly-index-series" id="toc-quarterly-index-series">Quarterly index series</a></li>
</ul></li>
<li><a href="#references" id="toc-references">References</a></li>
</ul>
</div>

<p><br /><br /> The Harmonised Index of Consumer Prices (HICP) is the key
economic figure to measure inflation in the euro area. The methodology
underlying the HICP is documented in the HICP Methodological Manual
<span class="citation">(European Commission 2024)</span>. Based on this
manual, the <code>hicp</code>-package provides functions for data users
to work with publicly available HICP price indices and weights
(<em>upper-level aggregation</em>).</p>
<p>This vignette highlights the main package features. It contains three
sections on data access, the classification of individual consumption by
purpose (COICOP) underlying the HICP, as well as index aggregation,
change rates and contributions of lower-level indices to the overall
inflation rate. It also shows how the package functions can be similarly
used for working with quarterly index series like the owner-occupied
housing price index (OOHPI).</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># load package:</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(hicp)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># set global options:</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">options</span>(<span class="at">hicp.coicop.version=</span><span class="st">&quot;ecoicop.hicp&quot;</span>)         <span class="co"># the coicop version to be used</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">options</span>(<span class="at">hicp.coicop.bundles=</span>hicp<span class="sc">:::</span>coicop.bundles)  <span class="co"># coicop bundle code dictionary (e.g., 08X)</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">options</span>(<span class="at">hicp.all.items.code=</span><span class="st">&quot;00&quot;</span>)                   <span class="co"># internal code for the all-items index</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">options</span>(<span class="at">hicp.chatty=</span><span class="cn">TRUE</span>)                           <span class="co"># print package-specific messages and warnings</span></span></code></pre></div>
<div id="hicp-data" class="section level1">
<h1>HICP data</h1>
<p>The <code>hicp</code>-package offers easy access to HICP data from
Eurostat’s public <a href="https://ec.europa.eu/eurostat/data/database">database</a>. For
that purpose, it uses the download functionality provided by Eurostat’s
<a href="https://CRAN.R-project.org/package=restatapi"><code>restatapi</code></a>-package.
This section shows how to list, filter and retrieve HICP data using the
functions <code>datasets()</code>, <code>datafilters()</code>, and
<code>data()</code>.</p>
<div id="step-1-available-data-sets" class="section level2">
<h2>Step 1: Available data sets</h2>
<p>Eurostat’s database contains various data sets of different
statistics. All data sets are classified by topic and can be accessed
via a navigation tree. HICP data can be found under “Economy and finance
/ Prices”. An even simpler solution that does not require visiting
Eurostat’s database is provided by the function <code>datasets()</code>,
which lists all available HICP data sets with corresponding metadata
(e.g., number of observations, last update).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># download table of available HICP data sets:</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>dtd <span class="ot">&lt;-</span> <span class="fu">datasets</span>()</span></code></pre></div>
<p>The function output shows the first five HICP data sets. As can be
seen, a short description of each data set and some metadata are
provided. The variable <code>code</code> is the data set identifier,
which is needed to filter and download data.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>dtd[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">list</span>(title, code, lastUpdate, values)]</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt;                                                                 title</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt;                                                                &lt;char&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt; 1:                  HICP at constant tax rates - monthly data (index)</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; 2:  HICP at constant tax rates - monthly data (annual rate of change)</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="co">#&gt; 3: HICP at constant tax rates - monthly data (monthly rate of change)</span></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; 4:                           HICP - administered prices (composition)</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; 5:                                             HICP - country weights</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt;             code lastUpdate  values</span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt;           &lt;char&gt;     &lt;char&gt;   &lt;num&gt;</span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt; 1: prc_hicp_cind 2025.01.17 2193537</span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt; 2: prc_hicp_cann 2025.01.17 2016222</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt; 3: prc_hicp_cmon 2025.01.17 4357812</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt; 4:  prc_hicp_apc 2025.01.17  728607</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt; 5:  prc_hicp_cow 2024.02.22    2921</span></span></code></pre></div>
</div>
<div id="step-2-allowed-data-filters" class="section level2">
<h2>Step 2: Allowed data filters</h2>
<p>The HICP is compiled each month in each member state of the European
Union (EU) for various items. Its compilation started in 1996.
Therefore, the data set of price indices is relatively large. Sometimes,
however, data users only need the price indices of certain years or
specific countries. Eurostat’s API and, thus, the
<code>restatapi</code>-package allows to provide filters on each data
request, e.g., to download only the price indices of the euro area for
the all-items HICP. The filtering options can differ for each data set.
Therefore, the function <code>datafilters()</code> returns the allowed
filtering options for a given data set.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># download allowed filters for data set &#39;prc_hicp_inw&#39;:</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>dtf <span class="ot">&lt;-</span> <span class="fu">datafilters</span>(<span class="at">id=</span><span class="st">&quot;prc_hicp_inw&quot;</span>)</span></code></pre></div>
<p>The function output shows that the data set <code>prc_hicp_inw</code>
for the HICP item weights can be filtered with respect to the frequency
(<code>freq</code>), the product code (<code>coicop</code>), and the
geographical area (<code>geo</code>). The table <code>dtf</code>
contains for each filter the allowed values, e.g., <code>CP011</code>
for <code>coicop</code> and <code>A</code> for <code>freq</code>. These
filters can be integrated in the data download as explained in the
following subsection.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># allowed filters:</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">unique</span>(dtf<span class="sc">$</span>concept)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="co">#&gt; [1] &quot;freq&quot;   &quot;coicop&quot; &quot;geo&quot;</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="co"># allowed filter values:</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>dtf[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a><span class="co">#&gt;    concept   code                             name</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a><span class="co">#&gt;     &lt;char&gt; &lt;char&gt;                           &lt;char&gt;</span></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co">#&gt; 1:    freq      A                           Annual</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a><span class="co">#&gt; 2:  coicop   CP00                   All-items HICP</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a><span class="co">#&gt; 3:  coicop   CP01 Food and non-alcoholic beverages</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co">#&gt; 4:  coicop  CP011                             Food</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a><span class="co">#&gt; 5:  coicop CP0111                Bread and cereals</span></span></code></pre></div>
</div>
<div id="step-3-data-download" class="section level2">
<h2>Step 3: Data download</h2>
<p>Applying a filter to a data request can noticeably reduce the
downloading time, particularly for bigger data sets. The function
<code>data()</code> can be used to download a specific data set.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># download item weights with filters:</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>item.weights <span class="ot">&lt;-</span> hicp<span class="sc">::</span><span class="fu">data</span>(<span class="at">id=</span><span class="st">&quot;prc_hicp_inw&quot;</span>, </span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>                           <span class="at">filters=</span><span class="fu">list</span>(<span class="st">&quot;geo&quot;</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;EA&quot;</span>,<span class="st">&quot;DE&quot;</span>,<span class="st">&quot;FR&quot;</span>)), </span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>                           <span class="at">date.range=</span><span class="fu">c</span>(<span class="st">&quot;2015&quot;</span>,<span class="st">&quot;2024&quot;</span>), </span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>                           <span class="at">flags=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>The object <code>item.weights</code> contains the item weights for
the euro area, Germany, and France from 2015 to 2024.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># inspect data:</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>item.weights[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, ]</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="co">#&gt; Key: &lt;coicop, geo, time&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt;    coicop    geo   time values  flags</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt;    &lt;char&gt; &lt;char&gt; &lt;char&gt;  &lt;num&gt; &lt;char&gt;</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; 1:     AP     DE   2015 141.49      b</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; 2:     AP     DE   2016 146.47   &lt;NA&gt;</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; 3:     AP     DE   2017 141.30   &lt;NA&gt;</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; 4:     AP     DE   2018 139.96   &lt;NA&gt;</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="co">#&gt; 5:     AP     DE   2019 141.78   &lt;NA&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="fu">nrow</span>(item.weights) <span class="co"># number of observations</span></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="co">#&gt; [1] 13412</span></span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="fu">unique</span>(item.weights<span class="sc">$</span>geo) <span class="co"># only EA, DE, and FR</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; [1] &quot;DE&quot; &quot;EA&quot; &quot;FR&quot;</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="fu">range</span>(item.weights<span class="sc">$</span>time) <span class="co"># from 2015 to 2023</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; [1] &quot;2015&quot; &quot;2024&quot;</span></span></code></pre></div>
<p>If one would have wanted the whole data set, the request would
simplify to <code>hicp::data(id=&quot;prc_hicp_inw&quot;)</code>.</p>
</div>
</div>
<div id="hicp-and-coicop" class="section level1">
<h1>HICP and COICOP</h1>
<p>HICP item weights and price indices are classified according to the
European COICOP (ECOICOP-HICP). This COICOP version is used by default
(<code>options(hicp.coicop.version=&quot;ecoicop.hicp&quot;)</code>) but others
are available in the package as well. The all-items HICP includes twelve
item divisions, which are further broken down by consumption purpose. At
the lowest level of subclasses (5-digit codes), there is the finest
differentiation of items for which weights are available, e.g.,
<em>rice</em> (01111) or <em>bread</em> (01113). Both rice and bread
belong to the same class, <em>bread and cereals (0111)</em>, and, at
higher levels, to the same group <em>food (011)</em> and division
<em>food and non-alcoholic beverages (01)</em>. Hence, ECOICOP and thus
also the HICP follows a pre-defined hierarchical tree, where the item
weights of the all-items HICP add up to 1000. This section shows how to
work with the COICOP codes to derive for example the lowest level of
items that form the all-items HICP.</p>
<div id="coicop-codes-bundles-and-relatives" class="section level2">
<h2>COICOP codes, bundles, and relatives</h2>
<p><strong>COICOP codes and bundles.</strong> The COICOP codes
underlying the HICP (<a href="https://op.europa.eu/de/web/eu-vocabularies/dataset/-/resource?uri=http://publications.europa.eu/resource/dataset/ecoicop-hicp">ECOICOP</a>)
consist of numbers. The code <code>00</code> is used in this package for
the all-items HICP although it is no official COICOP code (see
<code>options(hicp.all.items.code=&quot;00&quot;)</code>). The codes of the twelve
divisions below are <code>01, 02,..., 12</code>. At the lowest level of
subclasses, the codes consist of 5 digits.</p>
<p>Using the function <code>is.coicop()</code>, it can be easily checked
if a code is a valid COICOP code or not. This excludes bundle codes like
<code>082_083</code>, which violate the standard COICOP code pattern,
but can be found in HICP data. Bundle codes can be generally detected
using the function <code>is.bundle()</code> and be ‘unbundled’ into the
underlying valid COICOP codes using the function
<code>unbundle()</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># example codes:</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;00&quot;</span>,<span class="st">&quot;CP00&quot;</span>,<span class="st">&quot;01&quot;</span>,<span class="st">&quot;08X&quot;</span>)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co"># check if bundle codes:</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="fu">is.bundle</span>(<span class="at">id=</span>ids)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; [1] FALSE FALSE FALSE  TRUE</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co"># unbundle any bundle codes into their components:</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="fu">unbundle</span>(<span class="at">id=</span>ids)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; [1] &quot;00&quot;</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt; [1] &quot;CP00&quot;</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt; [1] &quot;01&quot;</span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="co">#&gt; [1] &quot;082&quot; &quot;083&quot;</span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a><span class="co"># bundle codes are no valid ECOICOP codes:</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="fu">is.coicop</span>(<span class="at">id=</span>ids)</span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="co">#&gt; [1] FALSE FALSE  TRUE FALSE</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a></span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a><span class="co"># games of chance have a valid ECOICOP code:</span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="fu">is.coicop</span>(<span class="st">&quot;0943&quot;</span>, <span class="at">settings=</span><span class="fu">list</span>(<span class="at">coicop.version=</span><span class="st">&quot;ecoicop&quot;</span>))</span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a><span class="co"># but not in the ECOICOP-HICP version 1:</span></span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a><span class="fu">is.coicop</span>(<span class="st">&quot;0943&quot;</span>, <span class="at">settings=</span><span class="fu">list</span>(<span class="at">coicop.version=</span><span class="st">&quot;ecoicop.hicp&quot;</span>))</span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p><strong>COICOP relatives.</strong> COICOP codes available in the data
downloaded from Eurostat’s database should be generally valid (except
for the prefix “CP”). More relevant is thus the detection of children
and parent codes in the data. Children are those codes that belong to
the same higher-level code (or parent). Such relations can be direct
(e.g., <code>01-&gt;011</code>) or indirect (e.g.,
<code>01-&gt;0111</code>). It is important to note that children usually
exhibit exactly one parent, while a parent may contain multiple
children. This can be seen in the example below.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># example codes:</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;00&quot;</span>,<span class="st">&quot;01&quot;</span>,<span class="st">&quot;011&quot;</span>,<span class="st">&quot;01111&quot;</span>,<span class="st">&quot;01112&quot;</span>)</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co"># no direct parent for 01111 and 01112 available:</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="fu">parent</span>(<span class="at">id=</span>ids, <span class="at">usedict=</span><span class="cn">FALSE</span>, <span class="at">closest=</span><span class="cn">FALSE</span>, <span class="at">k=</span><span class="dv">1</span>)</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co">#&gt; [1] &quot;00&quot;</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="co">#&gt; [1] &quot;01&quot;</span></span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a><span class="co">#&gt; [[5]]</span></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a><span class="co"># but 011 is one indirect (or closest) parent:</span></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a><span class="fu">parent</span>(<span class="at">id=</span>ids, <span class="at">usedict=</span><span class="cn">FALSE</span>, <span class="at">closest=</span><span class="cn">TRUE</span>)</span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a><span class="co">#&gt; [1] &quot;00&quot;</span></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a><span class="co">#&gt; [1] &quot;01&quot;</span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a><span class="co">#&gt; [1] &quot;011&quot;</span></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a><span class="co">#&gt; [[5]]</span></span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a><span class="co">#&gt; [1] &quot;011&quot;</span></span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a><span class="co"># while 011 has two (indirect) children:</span></span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a><span class="fu">child</span>(<span class="at">id=</span>ids, <span class="at">usedict=</span><span class="cn">FALSE</span>, <span class="at">closest=</span><span class="cn">TRUE</span>)</span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a><span class="co">#&gt; [[1]]</span></span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a><span class="co">#&gt; [1] &quot;01&quot;</span></span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a><span class="co">#&gt; [[2]]</span></span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a><span class="co">#&gt; [1] &quot;011&quot;</span></span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-46"><a href="#cb9-46" tabindex="-1"></a><span class="co">#&gt; [[3]]</span></span>
<span id="cb9-47"><a href="#cb9-47" tabindex="-1"></a><span class="co">#&gt; [1] &quot;01111&quot; &quot;01112&quot;</span></span>
<span id="cb9-48"><a href="#cb9-48" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-49"><a href="#cb9-49" tabindex="-1"></a><span class="co">#&gt; [[4]]</span></span>
<span id="cb9-50"><a href="#cb9-50" tabindex="-1"></a><span class="co">#&gt; NULL</span></span>
<span id="cb9-51"><a href="#cb9-51" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb9-52"><a href="#cb9-52" tabindex="-1"></a><span class="co">#&gt; [[5]]</span></span>
<span id="cb9-53"><a href="#cb9-53" tabindex="-1"></a><span class="co">#&gt; NULL</span></span></code></pre></div>
</div>
<div id="deriving-the-coicop-tree-for-index-aggregation" class="section level2">
<h2>Deriving the COICOP tree for index aggregation</h2>
<p>The functions <code>child()</code> and <code>parents()</code> may be
useful for various reasons. To derive the composition of COICOP codes at
the lowest possible level, however, the function <code>tree()</code> is
better suited. For the HICP, the derivation of this composition can be
done separately for each country and year. Consequently, the selection
of COICOP codes may differ across space and time. If needed, however,
specifying the argument <code>by</code> in function <code>tree()</code>
allows to merge the composition of COICOP codes at the lowest possible
level, e.g., to obtain a unique selection of the same COICOP codes over
time. Because the derivation of COICOP codes searches in the whole
COICOP tree, the resulting composition of COICOP codes is also denoted
as the <em>COICOP tree</em> in this package.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="co"># adjust COICOP codes:</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>item.weights[, <span class="st">&quot;coicop&quot;</span><span class="sc">:=</span><span class="fu">gsub</span>(<span class="at">pattern=</span><span class="st">&quot;^CP&quot;</span>, <span class="at">replacement=</span><span class="st">&quot;&quot;</span>, <span class="at">x=</span>coicop)]</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co"># derive separate trees for each time period and country:</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>item.weights[, <span class="st">&quot;t1&quot;</span> <span class="sc">:=</span> <span class="fu">tree</span>(<span class="at">id=</span>coicop, <span class="at">w=</span>values, <span class="at">flag=</span><span class="cn">TRUE</span>, <span class="at">settings=</span><span class="fu">list</span>(<span class="at">w.tol=</span><span class="fl">0.1</span>)), by<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;geo&quot;</span>,<span class="st">&quot;time&quot;</span>)]</span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>item.weights[t1<span class="sc">==</span><span class="cn">TRUE</span>,</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>        <span class="fu">list</span>(<span class="st">&quot;n&quot;</span><span class="ot">=</span><span class="fu">uniqueN</span>(coicop),           <span class="co"># varying coicops over time and space</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>             <span class="st">&quot;w&quot;</span><span class="ot">=</span><span class="fu">sum</span>(values, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),  <span class="co"># weight sums should equal 1000</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>        by<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;geo&quot;</span>,<span class="st">&quot;time&quot;</span>)][<span class="fu">order</span>(geo,time),]</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a><span class="co">#&gt;        geo   time     n       w</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a><span class="co">#&gt;     &lt;char&gt; &lt;char&gt; &lt;int&gt;   &lt;num&gt;</span></span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a><span class="co">#&gt;  1:     DE   2015   295 1000.00</span></span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a><span class="co">#&gt;  2:     DE   2016   295 1000.00</span></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a><span class="co">#&gt;  3:     DE   2017   295 1000.00</span></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a><span class="co">#&gt;  4:     DE   2018   295 1000.00</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a><span class="co">#&gt;  5:     DE   2019   295 1000.00</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a><span class="co">#&gt; ---                            </span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a><span class="co">#&gt; 26:     FR   2020   295  999.99</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a><span class="co">#&gt; 27:     FR   2021   295  999.94</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a><span class="co">#&gt; 28:     FR   2022   295 1000.01</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a><span class="co">#&gt; 29:     FR   2023   295 1000.04</span></span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a><span class="co">#&gt; 30:     FR   2024   295  999.95</span></span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a><span class="co"># derive merged trees over time, but not across countries:</span></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a>item.weights[, <span class="st">&quot;t2&quot;</span> <span class="sc">:=</span> <span class="fu">tree</span>(<span class="at">id=</span>coicop, <span class="at">by=</span>time, <span class="at">w=</span>values, <span class="at">flag=</span><span class="cn">TRUE</span>, <span class="at">settings=</span><span class="fu">list</span>(<span class="at">w.tol=</span><span class="fl">0.1</span>)), by<span class="ot">=</span><span class="st">&quot;geo&quot;</span>]</span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a>item.weights[t2<span class="sc">==</span><span class="cn">TRUE</span>,</span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a>        <span class="fu">list</span>(<span class="st">&quot;n&quot;</span><span class="ot">=</span><span class="fu">uniqueN</span>(coicop),           <span class="co"># same selection over time in a country</span></span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a>             <span class="st">&quot;w&quot;</span><span class="ot">=</span><span class="fu">sum</span>(values, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),  <span class="co"># weight sums should equal 1000</span></span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a>        by<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;geo&quot;</span>,<span class="st">&quot;time&quot;</span>)][<span class="fu">order</span>(geo,time),]</span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a><span class="co">#&gt;        geo   time     n       w</span></span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a><span class="co">#&gt;     &lt;char&gt; &lt;char&gt; &lt;int&gt;   &lt;num&gt;</span></span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a><span class="co">#&gt;  1:     DE   2015   295 1000.00</span></span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a><span class="co">#&gt;  2:     DE   2016   295 1000.00</span></span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a><span class="co">#&gt;  3:     DE   2017   295 1000.00</span></span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a><span class="co">#&gt;  4:     DE   2018   295 1000.00</span></span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a><span class="co">#&gt;  5:     DE   2019   295 1000.00</span></span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a><span class="co">#&gt; ---                            </span></span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a><span class="co">#&gt; 26:     FR   2020   284  999.98</span></span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a><span class="co">#&gt; 27:     FR   2021   284  999.94</span></span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a><span class="co">#&gt; 28:     FR   2022   284 1000.02</span></span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a><span class="co">#&gt; 29:     FR   2023   284 1000.04</span></span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a><span class="co">#&gt; 30:     FR   2024   284  999.95</span></span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a><span class="co"># derive merged trees over countries and time:</span></span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a>item.weights[, <span class="st">&quot;t3&quot;</span> <span class="sc">:=</span> <span class="fu">tree</span>(<span class="at">id=</span>coicop, <span class="at">by=</span><span class="fu">paste</span>(geo,time), <span class="at">w=</span>values, <span class="at">flag=</span><span class="cn">TRUE</span>, <span class="at">settings=</span><span class="fu">list</span>(<span class="at">w.tol=</span><span class="fl">0.1</span>))]</span>
<span id="cb10-46"><a href="#cb10-46" tabindex="-1"></a>item.weights[t3<span class="sc">==</span><span class="cn">TRUE</span>,</span>
<span id="cb10-47"><a href="#cb10-47" tabindex="-1"></a>        <span class="fu">list</span>(<span class="st">&quot;n&quot;</span><span class="ot">=</span><span class="fu">uniqueN</span>(coicop),           <span class="co"># same selection over time and across countries</span></span>
<span id="cb10-48"><a href="#cb10-48" tabindex="-1"></a>             <span class="st">&quot;w&quot;</span><span class="ot">=</span><span class="fu">sum</span>(values, <span class="at">na.rm=</span><span class="cn">TRUE</span>)),  <span class="co"># weight sums should equal 1000</span></span>
<span id="cb10-49"><a href="#cb10-49" tabindex="-1"></a>        by<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;geo&quot;</span>,<span class="st">&quot;time&quot;</span>)][<span class="fu">order</span>(geo,time),]</span>
<span id="cb10-50"><a href="#cb10-50" tabindex="-1"></a><span class="co">#&gt;        geo   time     n       w</span></span>
<span id="cb10-51"><a href="#cb10-51" tabindex="-1"></a><span class="co">#&gt;     &lt;char&gt; &lt;char&gt; &lt;int&gt;   &lt;num&gt;</span></span>
<span id="cb10-52"><a href="#cb10-52" tabindex="-1"></a><span class="co">#&gt;  1:     DE   2015    93 1000.00</span></span>
<span id="cb10-53"><a href="#cb10-53" tabindex="-1"></a><span class="co">#&gt;  2:     DE   2016    93 1000.00</span></span>
<span id="cb10-54"><a href="#cb10-54" tabindex="-1"></a><span class="co">#&gt;  3:     DE   2017    93 1000.00</span></span>
<span id="cb10-55"><a href="#cb10-55" tabindex="-1"></a><span class="co">#&gt;  4:     DE   2018    93 1000.00</span></span>
<span id="cb10-56"><a href="#cb10-56" tabindex="-1"></a><span class="co">#&gt;  5:     DE   2019    93 1000.00</span></span>
<span id="cb10-57"><a href="#cb10-57" tabindex="-1"></a><span class="co">#&gt; ---                            </span></span>
<span id="cb10-58"><a href="#cb10-58" tabindex="-1"></a><span class="co">#&gt; 26:     FR   2020    93  999.99</span></span>
<span id="cb10-59"><a href="#cb10-59" tabindex="-1"></a><span class="co">#&gt; 27:     FR   2021    93 1000.02</span></span>
<span id="cb10-60"><a href="#cb10-60" tabindex="-1"></a><span class="co">#&gt; 28:     FR   2022    93 1000.03</span></span>
<span id="cb10-61"><a href="#cb10-61" tabindex="-1"></a><span class="co">#&gt; 29:     FR   2023    93  999.98</span></span>
<span id="cb10-62"><a href="#cb10-62" tabindex="-1"></a><span class="co">#&gt; 30:     FR   2024    93  999.96</span></span></code></pre></div>
<p>All three COICOP trees in the example above can be used to aggregate
the all-items HICP in a single aggregation step as the item weights add
up to 1000, respectively. While the selection of COICOP codes varies
over time and across countries for <code>t1</code>, it is the same over
time and across countries for <code>t3</code>.</p>
</div>
</div>
<div id="index-aggregation-rates-of-change-and-contributions" class="section level1">
<h1>Index aggregation, rates of change, and contributions</h1>
<p>The HICP is a chain-linked Laspeyres-type index <span class="citation">(European Union 2016)</span>. The (unchained) price
indices in each calendar year refer to December of the previous year,
which is the <em>price reference period</em>. These price indices are
chain-linked to the existing index using December to obtain the HICP.
The HICP indices currently refer to the <em>index reference period</em>
2015=100. Monthly and annual change rates can be derived from the price
indices. The contributions of the price changes of individual items to
the annual rate of change can be computed by the “Ribe contributions”.
More details can be found in <span class="citation">European Commission
(2024, chap. 8)</span>.</p>
<div id="index-aggregation" class="section level2">
<h2>Index aggregation</h2>
<p>The all-items index is a weighted average of the items’ subindices.
However, because the HICP is a chain index, the subindices can not
simply be aggregated. They first need to be unchained, i.e., expressed
relative to December of the previous year. These unchained indices can
then be aggregated as a weighted average. Since the Laspeyres-type index
is <em>consistent in aggregation</em>, the aggregation can be done
gradually from the bottom level to the top or directly in one step.</p>
<p>In the following example, the euro area HICP is computed directly in
one step and also gradually through all higher-level indices. First, the
monthly price indices are downloaded from Eurostat’s database for the
index reference period 2015=100 (<code>unit</code>) and the period from
December 2014 to December 2024.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># download monthly price indices:</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>prc <span class="ot">&lt;-</span> hicp<span class="sc">::</span><span class="fu">data</span>(<span class="at">id=</span><span class="st">&quot;prc_hicp_midx&quot;</span>, </span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>                  <span class="at">filter=</span><span class="fu">list</span>(<span class="at">unit=</span><span class="st">&quot;I15&quot;</span>, <span class="at">geo=</span><span class="st">&quot;EA&quot;</span>),</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>                  <span class="at">date.range=</span><span class="fu">c</span>(<span class="st">&quot;2014-12&quot;</span>, <span class="st">&quot;2024-12&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="co"># manipulate data:</span></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>prc[, <span class="st">&quot;time&quot;</span><span class="sc">:=</span><span class="fu">as.Date</span>(<span class="fu">paste0</span>(time, <span class="st">&quot;-01&quot;</span>))]</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>prc[, <span class="st">&quot;year&quot;</span><span class="sc">:=</span><span class="fu">as.integer</span>(<span class="fu">format</span>(time, <span class="st">&quot;%Y&quot;</span>))]</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>prc[, <span class="st">&quot;coicop&quot;</span> <span class="sc">:=</span> <span class="fu">gsub</span>(<span class="at">pattern=</span><span class="st">&quot;^CP&quot;</span>, <span class="at">replacement=</span><span class="st">&quot;&quot;</span>, <span class="at">x=</span>coicop)]</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="fu">setnames</span>(<span class="at">x=</span>prc, <span class="at">old=</span><span class="st">&quot;values&quot;</span>, <span class="at">new=</span><span class="st">&quot;index&quot;</span>)</span></code></pre></div>
<p>Second, the price indices are unchained separately for each ECOICOP
using the function <code>unchain()</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># unchain price indices:</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>prc[, <span class="st">&quot;dec_ratio&quot;</span> <span class="sc">:=</span> <span class="fu">unchain</span>(<span class="at">x=</span>index, <span class="at">t=</span>time), by<span class="ot">=</span><span class="st">&quot;coicop&quot;</span>]</span></code></pre></div>
<p>The (unchained) price indices <code>prc</code> and the item weights
<code>inw</code> are then merged into one data set.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># manipulate item weights:</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>inw <span class="ot">&lt;-</span> item.weights[geo<span class="sc">==</span><span class="st">&quot;EA&quot;</span>, <span class="fu">list</span>(coicop,geo,time,values,t1)]</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>inw[, <span class="st">&quot;time&quot;</span><span class="sc">:=</span><span class="fu">as.integer</span>(time)]</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="fu">setnames</span>(<span class="at">x=</span>inw, <span class="at">old=</span><span class="fu">c</span>(<span class="st">&quot;time&quot;</span>,<span class="st">&quot;values&quot;</span>,<span class="st">&quot;t1&quot;</span>), <span class="at">new=</span><span class="fu">c</span>(<span class="st">&quot;year&quot;</span>,<span class="st">&quot;weight&quot;</span>,<span class="st">&quot;tree&quot;</span>))</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a><span class="co"># merge price indices and item weights:</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>hicp.data <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x=</span>prc, <span class="at">y=</span>inw, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;geo&quot;</span>,<span class="st">&quot;coicop&quot;</span>,<span class="st">&quot;year&quot;</span>), <span class="at">all.x=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>Based on the derived ECOICOP tree, the unchained price indices are
aggregated in one step using the function <code>laspeyres()</code>,
chained into a long-term index series using the function
<code>chain()</code>, and finally re-referenced to the index reference
period 2015 using the function <code>rebase()</code>. The resulting
index is plotted below.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># compute all-items HICP in one aggregation step:</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>hicp.own <span class="ot">&lt;-</span> hicp.data[tree<span class="sc">==</span><span class="cn">TRUE</span>, </span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>                      <span class="fu">list</span>(<span class="st">&quot;laspey&quot;</span><span class="ot">=</span><span class="fu">laspeyres</span>(<span class="at">x=</span>dec_ratio, <span class="at">w0=</span>weight)), </span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>                      by<span class="ot">=</span><span class="st">&quot;time&quot;</span>]</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="fu">setorderv</span>(<span class="at">x=</span>hicp.own, <span class="at">cols=</span><span class="st">&quot;time&quot;</span>)</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="co"># chain the resulting index:</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>hicp.own[, <span class="st">&quot;chain_laspey&quot;</span> <span class="sc">:=</span> <span class="fu">chain</span>(<span class="at">x=</span>laspey, <span class="at">t=</span>time, <span class="at">by=</span><span class="dv">12</span>)]</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="co"># rebase the index to 2015:</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>hicp.own[, <span class="st">&quot;chain_laspey_15&quot;</span> <span class="sc">:=</span> <span class="fu">rebase</span>(<span class="at">x=</span>chain_laspey, <span class="at">t=</span>time, <span class="at">t.ref=</span><span class="st">&quot;2015&quot;</span>)]</span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="co"># plot all-items index:</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="fu">plot</span>(chain_laspey_15<span class="sc">~</span>time, <span class="at">data=</span>hicp.own, <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Time&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;Index&quot;</span>)</span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Euro area HICP&quot;</span>)</span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
<p>Similarly, the (unchained) price indices are aggregated gradually
following the ECOICOP tree, which produces in addition to the all-items
index all lower-level indices.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># compute all-items HICP gradually from bottom to top:</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>hicp.own.all <span class="ot">&lt;-</span> hicp.data[ , <span class="fu">aggregate.tree</span>(<span class="at">x=</span>dec_ratio, <span class="at">w0=</span>weight, <span class="at">id=</span>coicop, <span class="at">formula=</span>laspeyres), </span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>                           by<span class="ot">=</span><span class="st">&quot;time&quot;</span>]</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a><span class="fu">setorderv</span>(<span class="at">x=</span>hicp.own.all, <span class="at">cols=</span><span class="st">&quot;time&quot;</span>)</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>hicp.own.all[, <span class="st">&quot;chain_laspey&quot;</span> <span class="sc">:=</span> <span class="fu">chain</span>(<span class="at">x=</span>laspeyres, <span class="at">t=</span>time, <span class="at">by=</span><span class="dv">12</span>), by<span class="ot">=</span><span class="st">&quot;id&quot;</span>]</span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>hicp.own.all[, <span class="st">&quot;chain_laspey_15&quot;</span> <span class="sc">:=</span> <span class="fu">rebase</span>(<span class="at">x=</span>chain_laspey, <span class="at">t=</span>time, <span class="at">t.ref=</span><span class="st">&quot;2015&quot;</span>), by<span class="ot">=</span><span class="st">&quot;id&quot;</span>]</span></code></pre></div>
<p>A comparison to the all-items index that has been computed in one
step shows no differences. This highlights the consistency in
aggregation of the Laspeyres-type index.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># compare all-items HICP from direct and step-wise aggregation:</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>agg.comp <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x=</span>hicp.own.all[id<span class="sc">==</span><span class="st">&quot;00&quot;</span>, <span class="fu">list</span>(time, <span class="st">&quot;index_stpwse&quot;</span><span class="ot">=</span>chain_laspey_15)],</span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>                  <span class="at">y=</span>hicp.own[, <span class="fu">list</span>(time, <span class="st">&quot;index_direct&quot;</span><span class="ot">=</span>chain_laspey_15)],</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>                  <span class="at">by=</span><span class="st">&quot;time&quot;</span>)</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="co"># no differences -&gt; consistent in aggregation:</span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="fu">nrow</span>(agg.comp[<span class="fu">abs</span>(index_stpwse<span class="sc">-</span>index_direct)<span class="sc">&gt;</span><span class="fl">1e-4</span>,])</span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p>User-defined aggregates can be easily calculated with the functions
<code>aggregate()</code> and <code>disaggregate()</code>. This is
particularly useful for the calculation of the HICP special aggregates
like food, energy or the overall index excluding the two.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># compute food and energy by aggregation:</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>spa <span class="ot">&lt;-</span> spec.aggs[code<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;FOOD&quot;</span>,<span class="st">&quot;NRG&quot;</span>), ]</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>hicp.data[time<span class="sc">&gt;=</span><span class="st">&quot;2019-12-01&quot;</span>,</span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>          <span class="fu">aggregate</span>(<span class="at">x=</span>dec_ratio, <span class="at">w0=</span>weight, <span class="at">id=</span>coicop,</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>                    <span class="at">agg=</span>spa<span class="sc">$</span>composition,</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>                    <span class="at">settings=</span><span class="fu">list</span>(<span class="at">names=</span>spa<span class="sc">$</span>code)), </span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>          by<span class="ot">=</span><span class="st">&quot;time&quot;</span>]</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a><span class="co">#&gt;            time     id     w0 laspeyres</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a><span class="co">#&gt;          &lt;Date&gt; &lt;char&gt;  &lt;num&gt;     &lt;num&gt;</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a><span class="co">#&gt;   1: 2019-12-01    NRG 101.31 1.0021199</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a><span class="co">#&gt;   2: 2019-12-01   FOOD 190.17 1.0201893</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a><span class="co">#&gt;   3: 2020-01-01    NRG  98.49 1.0079341</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a><span class="co">#&gt;   4: 2020-01-01   FOOD 190.73 1.0067257</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a><span class="co">#&gt;   5: 2020-02-01    NRG  98.49 0.9916196</span></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a><span class="co">#&gt;  ---                                   </span></span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a><span class="co">#&gt; 118: 2024-10-01   FOOD 194.71 1.0255994</span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a><span class="co">#&gt; 119: 2024-11-01    NRG  99.11 0.9952538</span></span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a><span class="co">#&gt; 120: 2024-11-01   FOOD 194.71 1.0273904</span></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a><span class="co">#&gt; 121: 2024-12-01    NRG  99.11 1.0014037</span></span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a><span class="co">#&gt; 122: 2024-12-01   FOOD 194.71 1.0261042</span></span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a><span class="co"># compute overall index excluding food and energy by disaggregation</span></span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a>hicp.data[time<span class="sc">&gt;=</span><span class="st">&quot;2019-12-01&quot;</span>,</span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a>          <span class="fu">disaggregate</span>(<span class="at">x=</span>dec_ratio, <span class="at">w0=</span>weight, <span class="at">id=</span>coicop,</span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a>                       <span class="at">agg=</span><span class="fu">list</span>(<span class="st">&quot;00&quot;</span><span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;FOOD&quot;</span>,<span class="st">&quot;NRG&quot;</span>)),</span>
<span id="cb18-26"><a href="#cb18-26" tabindex="-1"></a>                       <span class="at">settings=</span><span class="fu">list</span>(<span class="at">names=</span><span class="st">&quot;TOT_X_FOOD_NRG&quot;</span>)), </span>
<span id="cb18-27"><a href="#cb18-27" tabindex="-1"></a>          by<span class="ot">=</span><span class="st">&quot;time&quot;</span>]</span>
<span id="cb18-28"><a href="#cb18-28" tabindex="-1"></a><span class="co">#&gt;           time             id     w0 laspeyres</span></span>
<span id="cb18-29"><a href="#cb18-29" tabindex="-1"></a><span class="co">#&gt;         &lt;Date&gt;         &lt;char&gt;  &lt;num&gt;     &lt;num&gt;</span></span>
<span id="cb18-30"><a href="#cb18-30" tabindex="-1"></a><span class="co">#&gt;  1: 2019-12-01 TOT_X_FOOD_NRG 708.53 1.0130118</span></span>
<span id="cb18-31"><a href="#cb18-31" tabindex="-1"></a><span class="co">#&gt;  2: 2020-01-01 TOT_X_FOOD_NRG 710.78 0.9829321</span></span>
<span id="cb18-32"><a href="#cb18-32" tabindex="-1"></a><span class="co">#&gt;  3: 2020-02-01 TOT_X_FOOD_NRG 710.78 0.9868098</span></span>
<span id="cb18-33"><a href="#cb18-33" tabindex="-1"></a><span class="co">#&gt;  4: 2020-03-01 TOT_X_FOOD_NRG 710.78 0.9980751</span></span>
<span id="cb18-34"><a href="#cb18-34" tabindex="-1"></a><span class="co">#&gt;  5: 2020-04-01 TOT_X_FOOD_NRG 710.78 1.0054154</span></span>
<span id="cb18-35"><a href="#cb18-35" tabindex="-1"></a><span class="co">#&gt; ---                                           </span></span>
<span id="cb18-36"><a href="#cb18-36" tabindex="-1"></a><span class="co">#&gt; 57: 2024-08-01 TOT_X_FOOD_NRG 706.17 1.0251445</span></span>
<span id="cb18-37"><a href="#cb18-37" tabindex="-1"></a><span class="co">#&gt; 58: 2024-09-01 TOT_X_FOOD_NRG 706.17 1.0258097</span></span>
<span id="cb18-38"><a href="#cb18-38" tabindex="-1"></a><span class="co">#&gt; 59: 2024-10-01 TOT_X_FOOD_NRG 706.17 1.0283045</span></span>
<span id="cb18-39"><a href="#cb18-39" tabindex="-1"></a><span class="co">#&gt; 60: 2024-11-01 TOT_X_FOOD_NRG 706.17 1.0224486</span></span>
<span id="cb18-40"><a href="#cb18-40" tabindex="-1"></a><span class="co">#&gt; 61: 2024-12-01 TOT_X_FOOD_NRG 706.17 1.0270710</span></span></code></pre></div>
<p>The resulting aggregates can finally be chained and rebased as shown
before.</p>
<p>User-defined functions can be passed to <code>aggregate()</code> as
well, which allows aggregation using various weighted or unweighted
bilateral index formulas. By contrast, the function
<code>disaggregate()</code> requires the underlying data to be
aggregated as a Laspeyres-type index.</p>
</div>
<div id="rates-of-change-and-contributions" class="section level2">
<h2>Rates of change and contributions</h2>
<p>The HICP indices show the price change between a comparison period
and the index reference period. However, data users are more often
interested in monthly and annual rates of change.</p>
<p>Monthly change rates are computed by dividing the index in the
current period by the index one month before, while annual change rates
are derived by comparing the index in the current month to the index in
the same month one year before. Both can be easily derived using the
function <code>rates()</code>. Contributions of the price changes of
individual items to the annual rate of change can be computed by the
Ribe or Kirchner contributions as implemented in the function
<code>contrib()</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># compute annual rates of change for the all-items HICP:</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>hicp.data[, <span class="st">&quot;ar&quot;</span> <span class="sc">:=</span> <span class="fu">rates</span>(<span class="at">x=</span>index, <span class="at">t=</span>time, <span class="at">type=</span><span class="st">&quot;year&quot;</span>), by<span class="ot">=</span><span class="fu">c</span>(<span class="st">&quot;geo&quot;</span>,<span class="st">&quot;coicop&quot;</span>)]</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co"># add all-items hicp:</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>hicp.data <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x=</span>hicp.data,</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>                   <span class="at">y=</span>hicp.data[coicop<span class="sc">==</span><span class="st">&quot;00&quot;</span>, <span class="fu">list</span>(geo,time,index,weight)],</span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a>                   <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;geo&quot;</span>,<span class="st">&quot;time&quot;</span>), <span class="at">all.x=</span><span class="cn">TRUE</span>, <span class="at">suffixes=</span><span class="fu">c</span>(<span class="st">&quot;&quot;</span>,<span class="st">&quot;_all&quot;</span>))</span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co"># ribe decomposition:</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a>hicp.data[, <span class="st">&quot;ribe&quot;</span> <span class="sc">:=</span> <span class="fu">contrib</span>(<span class="at">x=</span>index, <span class="at">w=</span>weight, <span class="at">t=</span>time, </span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a>                              <span class="at">x.all=</span>index_all, <span class="at">w.all=</span>weight_all, <span class="at">type=</span><span class="st">&quot;year&quot;</span>),</span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>          by<span class="ot">=</span><span class="st">&quot;coicop&quot;</span>]</span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a><span class="co"># annual change rates and contribtuions over time:</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a><span class="fu">plot</span>(ar<span class="sc">~</span>time, <span class="at">data=</span>hicp.data[coicop<span class="sc">==</span><span class="st">&quot;00&quot;</span>,],</span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a>     <span class="at">type=</span><span class="st">&quot;l&quot;</span>, <span class="at">xlab=</span><span class="st">&quot;Time&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;&quot;</span>, <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">12</span>))</span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a><span class="fu">lines</span>(ribe<span class="sc">~</span>time, <span class="at">data=</span>hicp.data[coicop<span class="sc">==</span><span class="st">&quot;011&quot;</span>], <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a><span class="fu">title</span>(<span class="st">&quot;Contributions of food to overall inflation&quot;</span>)</span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>,<span class="st">&quot;red&quot;</span>), <span class="at">lty=</span><span class="dv">1</span>, <span class="at">bty=</span><span class="st">&quot;n&quot;</span>, </span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a>       <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Overall inflation (in %)&quot;</span>, <span class="st">&quot;Contributions of food (in pp-points)&quot;</span>))</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" style="display: block; margin: auto;" /></p>
</div>
<div id="quarterly-index-series" class="section level2">
<h2>Quarterly index series</h2>
<p>Most of the calculations shown in the previous two sections can be
similarly done for quarterly (or annual) index series. The
owner-occupied housing price index (OOHPI) is a prominent example for a
chained quarterly price index. The OOHPI indices and weights can be
downloaded from Eurostat’s database. Below, this is done for the period
from 2014 to 2024 for the euro area.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># download quarterly OOHPI for euro area:</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>dtp <span class="ot">&lt;-</span> hicp<span class="sc">::</span><span class="fu">data</span>(<span class="at">id=</span><span class="st">&quot;prc_hpi_ooq&quot;</span>, </span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>                  <span class="at">filter=</span><span class="fu">list</span>(<span class="at">unit=</span><span class="st">&quot;I15_Q&quot;</span>, <span class="at">geo=</span><span class="st">&quot;EA&quot;</span>),</span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>                  <span class="at">date.range=</span><span class="fu">c</span>(<span class="st">&quot;2014-10&quot;</span>,<span class="st">&quot;2024-12&quot;</span>))</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a><span class="co"># download annual OOH weights for euro area:</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>dtw <span class="ot">&lt;-</span> hicp<span class="sc">::</span><span class="fu">data</span>(<span class="at">id=</span><span class="st">&quot;prc_hpi_ooinw&quot;</span>, </span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>                  <span class="at">filter=</span><span class="fu">list</span>(<span class="at">geo=</span><span class="st">&quot;EA&quot;</span>),</span>
<span id="cb20-9"><a href="#cb20-9" tabindex="-1"></a>                  <span class="at">date.range=</span><span class="fu">c</span>(<span class="st">&quot;2014&quot;</span>,<span class="st">&quot;2024&quot;</span>))</span></code></pre></div>
<p>Before calculations can start, any time variables in the data must be
put first into proper dates. Afterwards, the indices and weights can be
merged into a single data set.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># manipulate indices:</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>dtp[, <span class="fu">c</span>(<span class="st">&quot;year&quot;</span>,<span class="st">&quot;quarter&quot;</span>) <span class="sc">:=</span> <span class="fu">tstrsplit</span>(<span class="at">x=</span>time, <span class="at">split=</span><span class="st">&quot;-Q&quot;</span>, <span class="at">fixed=</span><span class="cn">TRUE</span>)]</span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>dtp[, <span class="st">&quot;year&quot;</span><span class="sc">:=</span><span class="fu">as.integer</span>(year)]</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>dtp[, <span class="st">&quot;quarter&quot;</span><span class="sc">:=</span><span class="fu">as.integer</span>(quarter)]</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>dtp[, <span class="st">&quot;time&quot;</span><span class="sc">:=</span><span class="fu">as.Date</span>(<span class="fu">paste</span>(year, quarter<span class="sc">*</span><span class="dv">3</span>, <span class="st">&quot;01&quot;</span>, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>), <span class="at">format=</span><span class="st">&quot;%Y-%m-%d&quot;</span>)]</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>dtp[, <span class="fu">c</span>(<span class="st">&quot;unit&quot;</span>,<span class="st">&quot;quarter&quot;</span>)<span class="sc">:=</span><span class="cn">NULL</span>]</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a><span class="fu">setnames</span>(<span class="at">x=</span>dtp, <span class="at">old=</span><span class="st">&quot;values&quot;</span>, <span class="at">new=</span><span class="st">&quot;index&quot;</span>)</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a><span class="co"># manipulate item weights:</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>dtw[, <span class="st">&quot;year&quot;</span><span class="sc">:=</span><span class="fu">as.integer</span>(time)]</span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>dtw[, <span class="fu">c</span>(<span class="st">&quot;unit&quot;</span>,<span class="st">&quot;time&quot;</span>)<span class="sc">:=</span><span class="cn">NULL</span>]</span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a><span class="fu">setnames</span>(<span class="at">x=</span>dtw, <span class="at">old=</span><span class="st">&quot;values&quot;</span>, <span class="at">new=</span><span class="st">&quot;weight&quot;</span>)</span>
<span id="cb21-13"><a href="#cb21-13" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" tabindex="-1"></a><span class="co"># merge indices and item weights:</span></span>
<span id="cb21-15"><a href="#cb21-15" tabindex="-1"></a>dtooh <span class="ot">&lt;-</span> <span class="fu">merge</span>(<span class="at">x=</span>dtp, <span class="at">y=</span>dtw, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;geo&quot;</span>,<span class="st">&quot;expend&quot;</span>,<span class="st">&quot;year&quot;</span>), <span class="at">all.x=</span><span class="cn">TRUE</span>)</span>
<span id="cb21-16"><a href="#cb21-16" tabindex="-1"></a><span class="fu">setcolorder</span>(<span class="at">x=</span>dtooh, <span class="at">neworder=</span><span class="fu">c</span>(<span class="st">&quot;geo&quot;</span>,<span class="st">&quot;expend&quot;</span>,<span class="st">&quot;year&quot;</span>,<span class="st">&quot;time&quot;</span>))</span>
<span id="cb21-17"><a href="#cb21-17" tabindex="-1"></a><span class="fu">setkeyv</span>(<span class="at">x=</span>dtooh, <span class="at">cols=</span><span class="fu">c</span>(<span class="st">&quot;geo&quot;</span>,<span class="st">&quot;expend&quot;</span>,<span class="st">&quot;time&quot;</span>))</span></code></pre></div>
<p>The OOHPI is chained using the fourth quarter of the previous year.
Hence, for the aggregation of the OOHPI subcomponents, the indices must
first be unchained using the function <code>unchain()</code>. The
argument <code>by</code> of this function should now match to one month
of the relevant quarter. Hence, for the fourth quarter, <code>by</code>
should be set to <code>10</code>, <code>11</code> or <code>12</code>.
The unchaining then works as usual.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="co"># unchain indices:</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a>dtooh[, <span class="st">&quot;ratio&quot;</span> <span class="sc">:=</span> <span class="fu">unchain</span>(<span class="at">x=</span>index, <span class="at">t=</span>time, <span class="at">by=</span><span class="dv">12</span><span class="dt">L</span>), by<span class="ot">=</span><span class="st">&quot;expend&quot;</span>]</span></code></pre></div>
<p>The subcomponents of the OOHPI do not follow the COICOP system.
Instead, they are classified into expenditure categories
(<code>expend</code>). These must be (manually) selected for index
aggregation. For example, the total OOHPI is an aggregate of the two
categories ‘acquisition of dwellings’ (<code>DW_ACQ</code>) and
‘ownership of dwellings’ (<code>DW_OWN</code>). These two expenditure
categories are further broken down into finer ones. In the following,
they are used to compute the overall OOHPI, which is finally chained and
rebased to the year 2015.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># aggregate, chain and rebase:</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>dtagg <span class="ot">&lt;-</span> dtooh[expend<span class="sc">%in%</span><span class="fu">c</span>(<span class="st">&quot;DW_ACQ&quot;</span>,<span class="st">&quot;DW_OWN&quot;</span>), <span class="fu">list</span>(<span class="st">&quot;oohpi&quot;</span><span class="ot">=</span><span class="fu">laspeyres</span>(<span class="at">x=</span>ratio, <span class="at">w0=</span>weight)), by<span class="ot">=</span><span class="st">&quot;time&quot;</span>]</span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>dtagg[, <span class="st">&quot;oohpi&quot;</span> <span class="sc">:=</span> <span class="fu">chain</span>(<span class="at">x=</span>oohpi, <span class="at">t=</span>time)]</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>dtagg[, <span class="st">&quot;oohpi&quot;</span> <span class="sc">:=</span> <span class="fu">rebase</span>(<span class="at">x=</span>oohpi, <span class="at">t=</span>time, <span class="at">t.ref=</span><span class="st">&quot;2015&quot;</span>)]</span></code></pre></div>
<p>It is important to note that the functions <code>unchain()</code>,
<code>chain()</code> and <code>rebase()</code> auto-detect the frequency
of the time series. If users prefer to manually define the frequency,
the function settings can be changed to
<code>settings=list(freq=&quot;quarter&quot;)</code>. The same is true for the
derivation of annual (or quarterly) change rates:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="co"># derive annual change rates:</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a>dtagg[, <span class="st">&quot;ar&quot;</span> <span class="sc">:=</span> <span class="fu">rates</span>(<span class="at">x=</span>oohpi, <span class="at">t=</span>time, <span class="at">type=</span><span class="st">&quot;year&quot;</span>, <span class="at">settings=</span><span class="fu">list</span>(<span class="at">freq=</span><span class="st">&quot;quarter&quot;</span>))]</span></code></pre></div>
<p>The annual change rates <code>ar</code> show the percentage change of
the overall OOHPI in the current quarter compared to the same quarter
one year before. These change rates could be further decomposed into the
individual contributions of each expenditure category using the function
<code>contrib()</code>.</p>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Eurostat2024" class="csl-entry">
European Commission, Eurostat. 2024. <em><span class="nocase">Harmonised
Index of Consumer Prices (HICP) - Methodological Manual - 2024
edition</span></em>. Luxembourg: Publications Office of the European
Union. <a href="https://doi.org/10.2785/055028">https://doi.org/10.2785/055028</a>.
</div>
<div id="ref-EU2016" class="csl-entry">
European Union. 2016. <span>“<span class="nocase">Regulation (EU)
2016/792 of 11 May 2016 on harmonised indices of consumer prices and the
house price index</span>.”</span> <em>Official Journal of the European
Union</em> 135: 12–38.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
